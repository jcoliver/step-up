---
title: "Cancer data visualization and analysis"
author: "Jeff Oliver"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document: 
    fig_height: 4
  pdf_document:
    latex_engine: xelatex
    fig_height: 4
---

A two-hour workshop for participants in STEP-UP summer program on cancer prevention and control. There are 16 students, mostly upper-division undergraduates.

## Tasks:

+ **Add tinyurl for data dictionary**
+ **Add script header right before reading in cancer data**

### General flow to lesson:

+ At the beginning, look at the data (everyone opens on their own machine), do the tidy data explanation.
+ Add information about a data dictionary here, since the column names aren’t great (need to go to the original source to see what units are for these variables). Give them time to look over the data dictionary
+ Present one hypothesis, maybe see how language isolation predicts lung cancer incidence.
+ How do we go about addressing this?
    + Data visualization (an exercise for them in breakout rooms)
        + Do this visualization in the code
    + Statistical analyses
        + Discuss but don’t do
+ Ask them to generate hypotheses, picking one of the demographic variables to predict incidence; include term “disparity” in discussions.
+ Do the stats on language isolation and lung cancer
+ Do _another_ regression example, using earlier code.
+ Assign groups to test another hypothesis in breakout rooms
+ Show ice cream & sharks graph

#### Learning objectives

1. Describe “tidy data” principles of one observation per row, one data type per column
2. Explain how to show relationships in data with data visualization
3. Develop hypotheses to explain quantitative data patterns
4. Write code to visualize data and test hypotheses
5. Explain the difference between correlation & causation

<!--
1. Examine data to ensure quality
2. Develop hypotheses to explain trends
3. Visualize comparisons between two groups
4. Visualize relationships between two variables
5. Test relationships between variables
6. Understand the difference between correlation and causation
-->

## [DESCRIPTION OR MOTIVATION; 2-4 sentences that would be used for an announcement]

***

## Getting started

+ Start RStudio
+ Create a new project via File > New Project... > New Directory > New Project
+ Make `data` and `output` directories in the project
```{r create-directories, eval = FALSE}
dir.create("data")
dir.create("output")
```
+ Download data (come from [https://statecancerprofiles.cancer.gov/](https://statecancerprofiles.cancer.gov/))
    + These data are lung cancer data incidence rates for each state, along with some demographic data

```{r data-retrieve, eval = FALSE}
download.file(url = "tinyurl.com/cancer-data-csv", destfile = "data/cancer-data.csv")
```

Open the file in a spreadsheet program like Microsoft Excel, LibreOffice Sheets, or Google Sheets.

```{r load-data, echo = FALSE}
cancer_data <- read.csv(file = "data/cancer-data.csv")
```

Notice that we have `r ncol(cancer_data)` columns of data. These are in what is called 'tidy' format. That is because each row has the data for a single state and each column has only one kind of data in it.

Some of these column names are easy to interpret, others are not as useful. The names are very short and it makes them easy to do analyses with them, but they are not necessarily human friendly. So we need to also download the data dictionary that defines what each of those columns means.

```{r data-dictionary-retrieve, eval = FALSE}
download.file(url = "tinyurl.com/data-dictionary-csv", destfile = "data/data-dictionary.csv")
```

Open this file in your spreadsheet program and see what the columns represent.

```{r display-dictionary, echo = FALSE}
data_dictionary <- read.csv(file = "data/data-dictionary.csv")
knitr::kable(x = data_dictionary)
```

Now, back in R, we can start working with the data. We need to load the data into R so we can do our analyses.

```{r data-loading}
cancer_data <- read.csv(file = "data/cancer-data.csv")
```

We can also take a quick glance at some of these data in r with the `head` and `summary` commands.

```{r data-head}
head(cancer_data)
```

```{r data-summary}
summary(cancer_data)
```

***

## So what?

But what can we actually do with these data? Well, a lot, really. It really depends on the question you are interested in asking. So one thing we might be interested in is how language isolation affects the rates of lung cancer. That is, do states with a higher percentage of households that have difficulty with the English language have higher rates of lung cancer? This might happen because public health efforts may only be offered in English, and thus not reach all groups in need.

### Visualizing data

What would the data look like if this was the case? That is, if we had a plot of language isolation and rates of lung cancer, what would it look like if increased language isolation leads to increased rates of lung cancer? Take a few minutes to draw a plot by hand to show what this looks like.

We can wait.

So let us now look at the actual data. For this first plot, we will look at the incidence of lung cancer in females alone. We can use the `plot` command to show the data, instructing R to use the `lang.isolation` column for the x-axis and the `female.lung` column for the y-axis.

```{r plot-1}
plot(x = cancer_data$lang.isolation, y = cancer_data$female.lung)
```

Let us take a moment to make our axis labels a little prettier by re-running the plot code with the names we want to use for the x- and y-axes.

```{r plot-1}
plot(x = cancer_data$lang.isolation, y = cancer_data$female.lung,
     xlab = "Language isolation", ylab = "Lung cancer in females")
```

Hmmm...it is tough to tell from this plot alone if there is any predictive relationship between language isolation and the incidence of female lung cancer. Regardless of how this plot actually looks, we will want to run a statistical test to see if the relationship is statistically significant.

### Generating hypotheses

Before we do that though, let us again take a look at the demographic data we have. We are going to take a moment to generate a hypothesis for one of the other demographic variables. So, for one of the remaining variables (`r paste0(data_dictionary$name[4:7], collapse = ", ")`), consider how it might affect the incidence of lung cancer. If we consider our earlier investigation, the hypothesis we have is:

_The rate of lung cancer in females will increase as the amount of language isolation increases._

#### Exercise

Considering how the remaining demographic variables relate to health care disparities, take a moment to write out a hypothesis.

Now that you have your hypothesis, share it with your neighbor.

### Testing hypotheses

Let us now return to our original hypothesis, where we posit that language isolation can have an affect on lung cancer incidence. To test this hypothesis, we will use linear regression, which tests the relationship between two continuous-values variables. For the R code, we use the function `lm` to run the analysis and store the output in a variable called `lang_female_lm`.

_Aside_: When naming varibles, we want to make sure the names are acually useful, instead of things like `x` and `var`, which do not say much about what we are storing in them.

```{r test-lang-female}
lang_female_lm <- lm(cancer_data$female.lung ~ cancer_data$lang.isolation)
```

We can then look at the output of the linear regression that was stored in `lang_female_lm` by typing the name of the variable alone and running that line:

```{r show-lang-female}
lang_female_lm
```

The output shows the predicted relationship between our two variables, in terms of intercept and slope, but it does not show us whether or not this is a significant relationship. To retrieve that information, we need to use the `summary` function on the results of our linear regression:

```{r sig-lang-female}
summary(lang_female_lm)
```



***

## Comparing groups
### New script (reproducibility)

```{r t-test-script}
# Compare cancer incidence between sexes
# Jeff Oliver
# jcoliver@email.arizona.edu
# 2019-06-05
```

### Read in data & visualize male v. female incidence
```{r compare-male-female}
cancer_data <- read.csv(file = "data/cancer-data.csv")
boxplot(cancer_data$female.lung, cancer_data$male.lung)
```

But the x-axis doesn't tell us what "1" and "2" correspond to.

```{r boxplot-axis-names}
boxplot(list(female = cancer_data$female.lung, male = cancer_data$male.lung))
```

### Run t-test
```{r sexes-t-test}
t.test(x = cancer_data$female.lung, y = cancer_data$male.lung)
```

***

## Exercise
+ Get in groups; take five minutes to draw how you might show relationship between variables; ideally comes from one of the hypotheses students generated

***

## Testing relationships
### New script
```{r regression-script}
# Compare cancer incidence between sexes
# Jeff Oliver
# jcoliver@email.arizona.edu
# 2019-06-05
```

### Plot data & describe hypothesis
```{r plot-two-variables}
cancer_data <- read.csv(file = "data/cancer-data.csv")
plot(x = cancer_data$income, y = cancer_data$male.lung)
```

Clean up the axis labels
```{r clean-plot}
plot(x = cancer_data$income, 
     y = cancer_data$male.lung,
     xlab = "Income (US $)",
     ylab = "Lung cancer incidence (males)")
```

### Test relationship
```{r linear-regression}
income.lm <- lm(cancer_data$male.lung ~ cancer_data$income)
summary(income.lm)
```

### Update plot
```{r update-regression-plot}
plot(x = cancer_data$income, 
     y = cancer_data$male.lung,
     xlab = "Income (US $)",
     ylab = "Lung cancer incidence (males)")
abline(income.lm)
```

### Correlation vs. Causation
Discuss:

```{r sharks, echo = FALSE}
ice.cream <- 1:12 + rnorm(n = 12, mean = 2)
shark.attacks <- round(5 * (1:12 + rnorm(n = 12, mean = 2)), digits = 0)
plot(x = ice.cream,
     y = shark.attacks,
     xlab = "Ice Cream Sales ($1,000)",
     ylab = "Shark Attacks")
abline(lm(shark.attacks ~ ice.cream))
```

### Some additional plotting options
```{r plot-both-sexes}
plot(x = cancer_data$income, 
     y = cancer_data$male.lung,
     xlab = "Income (US $)",
     ylab = "Lung cancer incidence",
     pch = 19,
     col = "orange")
points(x = cancer_data$income,
       y = cancer_data$female.lung,
       pch = 19,
       col = "forestgreen")
abline(income.lm, col = "orange", lty = 2)
abline(lm(female.lung ~ income, data = cancer_data), col = "forestgreen", lty = 2)
legend("topright",
       legend = c("Females", "Males"),
       col = c("forestgreen", "orange"),
       pch = 19,
       lty = 2)
```

***

## Additional resources

+ [resource one](url-one)
+ [resource two](url-two)
+ A [PDF version](https://jcoliver.github.io/learn-r/step-up-lesson.pdf) of this lesson

***

Questions?  e-mail me at <a href="mailto:jcoliver@email.arizona.edu">jcoliver@email.arizona.edu</a>.